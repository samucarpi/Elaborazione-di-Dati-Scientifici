<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Datafit engine - Eigenvector Research Documentation Wiki</title>



    <link rel="stylesheet" href="load.css" media="screen" />        
  

<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href=""/>
<meta name="generator" content="MediaWiki 1.39.6"/>
<meta name="format-detection" content="telephone=no"/>
<meta name="viewport" content="width=1000"/>
<link rel="icon" href="favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Eigenvector Research Documentation Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://www.wiki.eigenvector.com/api.php?action=rsd"/>
<link rel="alternate" type="application/atom+xml" title="Eigenvector Research Documentation Wiki Atom feed" href=""/>
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Datafit_engine rootpage-Datafit_engine skin-vector action-view skin-vector-legacy vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled"><div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body" role="main">
	<a id="top"></a>
	<div id="siteNotice"></div>
	<div class="mw-indicators">
	</div>
	<h1 id="firstHeading" class="firstHeading mw-first-heading"><a href="https://wiki.eigenvector.com/index.php?title=Datafit_engine"><span class="mw-page-title-main">Datafit engine</span></a></h1>
	<div id="bodyContent" class="vector-body">
		<div id="siteSub" class="noprint">From Eigenvector Research Documentation Wiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr"><div class="mw-parser-output"><div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Purpose"><span class="tocnumber">1</span> <span class="toctext">Purpose</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Synopsis"><span class="tocnumber">2</span> <span class="toctext">Synopsis</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Description"><span class="tocnumber">3</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Inputs"><span class="tocnumber">4</span> <span class="toctext">Inputs</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Options"><span class="tocnumber">5</span> <span class="toctext">Options</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Outputs"><span class="tocnumber">6</span> <span class="toctext">Outputs</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#See_Also"><span class="tocnumber">7</span> <span class="toctext">See Also</span></a></li>
</ul>
</div>

<h3><span class="mw-headline" id="Purpose">Purpose</span></h3>
<p>Asymmetric least squares with smoothing, baselining &amp; robust fitting.
</p>
<h3><span class="mw-headline" id="Synopsis">Synopsis</span></h3>
<dl><dd>[yb,z,options]  = datafit_engine(y,options);</dd>
<dd>options = datafit_engine('options');</dd></dl>
<h3><span class="mw-headline" id="Description">Description</span></h3>
<p>DATAFIT_ENGINE is used to A) provide a smoothed estimate (z) of the rows of input (y) or B) a baselined estimate the rows of input (y). In each case the objective function to be minimized is given by:
</p>
<dl><dd>O(z) = (y-z)'*W0*(y-z) + lambdas*z'*Ds'*Ws*Ds*z + lambdae*(y-ye-z)'*We*(y-ye-z) + lambdab*(Pa-z)'*Wb*(Pa-z) (1).</dd></dl>
<p>The weights W are diagonal matrices with entries 0&lt;w&lt;1 allowing individual points in the optimization to be weighted differently. The penalty magnitude is given by the scalar lambda factors.
</p><p>E.g., the first term in (1) includes W0 that has zeros where data are missing and ones elsewhere.
The second term uses a smoothing operator Ds and penalty factor lambdas to penalize roughness (by default Ds is the second difference operator). The third term is used to include equality constriants with penalty factor lambdae (if included) and the fourth term allows for basis functions (P) to be used (if included).
</p>
<dl><dd>A) Smoothing is obtained using options.trbflag = 'none' or 'middle'.    In this case the output (z), the smoothed estimate of (y) is likey    desired. Output yb = y - z would then correspond to fit residuals.    if options.trbflag = 'middle' a robust fitting strategy is used.</dd></dl>
<dl><dd>B) Baselining is obtained using options.trbflag = 'top' or 'bottom' via    an asymmetric least squares fitting strategy. In this case the output    (yb) is the baselined estimate of (y) and output (z) corresponds to the baseline.</dd></dl>
<p>See additional information on (options.trbflag) below.
</p>
<h3><span class="mw-headline" id="Inputs">Inputs</span></h3>
<ul><li><b>y</b> = <i>M</i> by <i>N</i> matrix of ROW vectors to be smoothed/fit (class "double" or "dataset").</li></ul>
<h3><span class="mw-headline" id="Options">Options</span></h3>
<p><i>options</i> =  a structure array with the following fields:
</p>
<ul><li><b>display</b>&#160;: [ {'off'} | 'on'] governs level of display (waitbar on/off).</li></ul>
<ul><li><b>trbflag</b>&#160;: [ {'none'} | 'middle' | 'bottom' | 'top' ]</li></ul>
<dl><dd><dl><dd>'none' runs the smoother once (see WSMOOTH),</dd>
<dd>'middle' uses robust least squares to fit a curve to the middle of the data,</dd>
<dd>'bottom' uses asymmetric least squares to fit a curve to the bottom of the data (e.g., baselining spectra),</dd>
<dd>'top'    uses asymmetric least squares to fit a curve to the top    of the data (e.g., fitting a Plank function).</dd></dl></dd></dl>
<p>Constraints, penalties and weights.
</p>
<ul><li><b>w0</b>&#160;: {ones(1,N)} weights on the fit term:      (y-z)'*W0*(y-z);</li></ul>
<dl><dd><dl><dd>[] if empty or not length N then</dd>
<dd>w0(y.include{2})&#160;:= 1 for (y) class DataSet or</dd>
<dd>w0&#160;:= ones(1,N) for (y) class double.</dd></dl></dd></dl>
<ul><li><b>lambdas</b>&#160;: {1} Positive scalar defines how hard to smooth. Typically 10 &lt; lambdas &lt;1e6 with large values giving more smoothing.</li>
<li><b>ws</b>&#160;: {ones(1,N)} weights on the smoothing term lambdas*z'*Ds'*Ws*Ds*z; [] if empty or not length N then ws&#160;:= ones(1,N).</li>
<li><b>widths</b>&#160;: {3} Smoothing window width for Ds (see SAVGOL). (Typically=3).</li>
<li><b>orders</b>&#160;: {2} Smoothing polynomial order for Ds (see SAVGOL). (Typically=2).</li>
<li><b>derivs</b>&#160;: {2} Smoothing derivative for Ds (see SAVGOL). (Typically=2).</li>
<li><b>lambdae</b>&#160;: {0} Positive scalar defines how hard to fit to equality constraints. Typically 0 &lt;= lambdae &lt;1e6.</li>
<li><b>ye</b>&#160;: {NaN(1,N)} non-NaN entries are the equality constraints on z, NaN entries are unconstrained.</li>
<li><b>we</b>&#160;: {zeros(1,N)} weights on equality constraint term lambdae*(z-y-ye)'*We*(z-y-ye) we(isnan(ye)) = 0, we(~isnan(ye)) = 1.</li>
<li><b>lambdab</b>&#160;: {0} Positive scalar defines how hard to fit to basis function(s). Typically 0 &lt; lambdab &lt;1e6.</li>
<li><b> wb</b>&#160;: {zeros(1,N)} weights on basis function term lambdab*(z-Pa)'*Wb*(z-Pa)</li>
<li><b>orderp</b>&#160;: {[]} polynomial order (scalar &gt;=0) (see POLYBASIS).</li>
<li><b>knotp</b>&#160;: {[]} (scalar integer &gt;=1) integer defining the number of uniformly distributed INTERIOR knots there are then knotp+2 knots positioned at t = linspace(1,N,knotp+2);  (see SMOOTHBASIS) (1xKt vector) defining manually placed knot positions on [1:N].</li></ul>
<dl><dd><dl><dd>Note: that knot positions must be such that there are at least 3 unique data points between eachknot.</dd></dl></dd></dl>
<ul><li><b>basisp</b>&#160;: {[]} NxKb custom basis. It is recommended that each column normalized to unit length (2-norm).</li>
<li><b>nonneg</b>&#160;: {[0] | 1 } scalar indiacting if non-negativity should be applied to the coefficients on (options.basisp). The default is 0 = no. Kbx1 vector of indices (ones and zeros) indicating which coefficients should be non-negative. (See FASTERNNLS);</li></ul>
<p>Robust and asymmetric iterative fitting parameters.
</p>
<ul><li><b>tol</b>&#160;: {[]} is the base fit tolerance (scalar). If empty it is estimated by the mean absolute deviation of y.data - savgol(y.data,3,1,0); (see MADC).</li>
<li><b>tfac</b>&#160;: {[1]} tolerance factor where res = (y.data-z)/(tol*tfac) is a considered large residual.</li>
<li><b>p</b>&#160;: {0.01} "asymmetry factor", where at each iteration w0 = (res&gt;tol*tfac)*p+(res&lt;=tol*tofac) .</li>
<li><b>ittol</b>&#160;: {1e-3} relative tolerance exit criterion norm(w0-w0old)/norm(w0)&lt;ittol.</li>
<li><b>itmax</b>&#160;: {100} maximum iterations exit criterion.</li>
<li><b>timemax</b>&#160;: {600} maximum time (s) for each row of y exit criterion.</li></ul>
<h3><span class="mw-headline" id="Outputs">Outputs</span></h3>
<ul><li><b>yb</b> = y - z.</li>
<li><b>z</b> = the smoothed estiamte of (y)..</li></ul>
<h3><span class="mw-headline" id="See_Also">See Also</span></h3>
<p><a href="baseline.html" title="Baseline">baseline</a>, <a href="baselineds.html" title="Baselineds">baselineds</a>, <a href="preprocess.html" title="Preprocess">preprocess</a>, <a href="wlsbaseline.html" title="Wlsbaseline">wlsbaseline</a>, <a href="madc.html" title="Madc">madc</a>
</p>
<!-- 
NewPP limit report
Cached time: 20240930042541
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc]
CPU time usage: 0.009 seconds
Real time usage: 0.010 seconds
Preprocessor visited node count: 20/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->

<!-- Saved in parser cache with key newwiki_eigenvector_com:pcache:idhash:1583-0!canonical and timestamp 20240930042541 and revision id 10904.
 -->
</div>
<div class="printfooter" data-nosnippet="">Retrieved from "<a dir="ltr" href="https://www.wiki.eigenvector.com/index.php?title=Datafit_engine&amp;oldid=10904">https://www.wiki.eigenvector.com/index.php?title=Datafit_engine&amp;oldid=10904</a>"</div></div>
		<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>
	</div>
</div>

<div id="mw-navigation">
	<h2>Navigation menu</h2>
	<div id="mw-head">
		

<nav id="p-personal" class="vector-menu mw-portlet mw-portlet-personal vector-user-menu-legacy" aria-labelledby="p-personal-label" role="navigation"  >
	<h3
		id="p-personal-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Personal tools</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</nav>

		<div id="left-navigation">
			

<nav id="p-namespaces" class="vector-menu mw-portlet mw-portlet-namespaces vector-menu-tabs vector-menu-tabs-legacy" aria-labelledby="p-namespaces-label" role="navigation"  >
	<h3
		id="p-namespaces-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Namespaces</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</nav>

			

<nav id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown" aria-labelledby="p-variants-label" role="navigation"  >
	<input type="checkbox"
		id="p-variants-checkbox"
		role="button"
		aria-haspopup="true"
		data-event-name="ui.dropdown-p-variants"
		class="vector-menu-checkbox"
		aria-labelledby="p-variants-label"
	/>
	<label
		id="p-variants-label"
		 aria-label="Change language variant"
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</nav>

		</div>
		<div id="right-navigation">
			

<nav id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs vector-menu-tabs-legacy" aria-labelledby="p-views-label" role="navigation"  >
	<h3
		id="p-views-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Views</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="ca-view" class="selected mw-list-item"><a href=""><span>Read</span></a></li></ul>
		
	</div>
</nav>

			

<nav id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown" aria-labelledby="p-cactions-label" role="navigation"  title="More options" >
	<input type="checkbox"
		id="p-cactions-checkbox"
		role="button"
		aria-haspopup="true"
		data-event-name="ui.dropdown-p-cactions"
		class="vector-menu-checkbox"
		aria-labelledby="p-cactions-label"
	/>
	<label
		id="p-cactions-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</nav>

			

		</form>
	</div>
</div>

		</div>
	</div>
	

<div id="mw-panel">
	<div id="p-logo" role="banner">
		<a class="mw-wiki-logo" href="main_page.html"
			title="Visit the main page"></a>
	</div>
	

<nav id="p-navigation" class="vector-menu mw-portlet mw-portlet-navigation vector-menu-portal portal" aria-labelledby="p-navigation-label" role="navigation"  >
	<h3
		id="p-navigation-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Navigation</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="n-Main-Page" class="mw-list-item"><a href="main_page.html"><span>Main Page</span></a></li><li id="n-PLS_Toolbox/Solo" class="mw-list-item"><a href="software_user_guide.html"><span>PLS_Toolbox/Solo</span></a></li><li id="n-MIA_Toolbox/Solo+MIA" class="mw-list-item"><a href="mia_toolbox_user_guide.html"><span>MIA_Toolbox/Solo+MIA</span></a></li><li id="n-Solo_Predictor" class="mw-list-item"><a href="solo_predictor_user_guide.html"><span>Solo_Predictor</span></a></li><li id="n-Model_Exporter" class="mw-list-item"><a href="model_exporter_user_guide.html"><span>Model_Exporter</span></a></li><li id="n-DataSet-Object" class="mw-list-item"><a href="dataset_object.html"><span>DataSet Object</span></a></li><li id="n-Frequently-Asked-Questions" class="mw-list-item"><a href="evri_faq.html"><span>Frequently Asked Questions</span></a></li><li id="n-Eigenvector-Homepage" class="mw-list-item"><a href="http://www.eigenvector.com/" rel="nofollow"><span>Eigenvector Homepage</span></a></li><li id="n-MediaWiki-Help" class="mw-list-item"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents"><span>MediaWiki Help</span></a></li></ul>
		
	</div>
</nav>

	

<nav id="p-tb" class="vector-menu mw-portlet mw-portlet-tb vector-menu-portal portal" aria-labelledby="p-tb-label" role="navigation"  >
	<h3
		id="p-tb-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Tools</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="t-whatlinkshere" class="mw-list-item"><a href="" title="A list of all wiki pages that link here [j]" accesskey="j"><span>What links here</span></a></li><li id="t-recentchangeslinked" class="mw-list-item"><a href="" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k"><span>Related changes</span></a></li><li id="t-specialpages" class="mw-list-item"><a href="" title="A list of all special pages [q]" accesskey="q"><span>Special pages</span></a></li><li id="t-print" class="mw-list-item"><a href="javascript:print();" rel="alternate" title="Printable version of this page [p]" accesskey="p"><span>Printable version</span></a></li><li id="t-permalink" class="mw-list-item"><a href="" title="Permanent link to this revision of this page"><span>Permanent link</span></a></li><li id="t-info" class="mw-list-item"><a href="" title="More information about this page"><span>Page information</span></a></li></ul>
		
	</div>
</nav>

	
</div>

</div>

<footer id="footer" class="mw-footer" role="contentinfo" >
	<ul id="footer-info">
	<li id="footer-info-lastmod"> This page was last edited on 5 December 2019, at 11:36.</li>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="eigenvector_research_documentation_wiki_privacy_policy.html">Privacy policy</a></li>
	<li id="footer-places-about"><a href="eigenvector_research_documentation_wiki_about.html">About Eigenvector Research Documentation Wiki</a></li>
	<li id="footer-places-disclaimer"><a href="eigenvector_research_documentation_wiki_general_disclaimer.html">Disclaimers</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-poweredbyico"><a href="https://www.mediawiki.org/"><img src="poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></li>
</ul>

</footer>


<br/></body>
</html>